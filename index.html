<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presentation Timer</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        // Enhanced YAML parser for our specific format
        window.jsyaml = {
            load: function(yaml) {
                try {
                    // Convert YAML-like format to JSON-like format
                    const lines = yaml.split('\n');
                    const data = {};
                    let currentSection = null;
                    
                    // Validate the first line is title
                    if (!lines[0]?.startsWith('title:')) {
                        throw new Error('YAML must start with title line');
                    }
                    
                    // Parse title
                    data.title = lines[0].split(':')[1].trim().replace(/['"]+/g, '');
                    
                    // Find sections start
                    let sectionsStart = -1;
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === 'sections:') {
                            sectionsStart = i;
                            data.sections = [];
                            break;
                        }
                    }
                    
                    if (sectionsStart === -1) {
                        throw new Error('No sections found in YAML');
                    }
                    
                    // Parse sections
                    for (let i = sectionsStart + 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line.startsWith('- name:')) {
                            currentSection = { 
                                name: line.split(':')[1].trim().replace(/['"]+/g, '') 
                            };
                            data.sections.push(currentSection);
                        } else if (line.startsWith('start:') || line.startsWith('end:')) {
                            if (!currentSection) {
                                throw new Error('Section property found without section name');
                            }
                            const [key, value] = line.split(':');
                            currentSection[key.trim()] = value.trim();
                        }
                    }
                    
                    // Validate required fields
                    data.sections.forEach(section => {
                        if (!section.name) throw new Error('Section missing name');
                        if (!section.start) throw new Error(`Section "${section.name}" missing start time`);
                        if (!section.end) throw new Error(`Section "${section.name}" missing end time`);
                    });
                    
                    return data;
                } catch (e) {
                    console.error('YAML parsing error:', e);
                    throw new Error(`Invalid YAML format: ${e.message}`);
                }
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- Section 1: Title -->
            <div class="header-section">
                <h1 id="title">Presentation Timer</h1>
            </div>
            
            <!-- Section 2: Import Button -->
            <div class="header-section">
                <div class="header-controls">
                    <input type="file" id="yaml-file-input" accept=".yaml,.yml" style="display: none;">
                    <button id="import-button">Import Settings</button>
                </div>
            </div>
            
            <!-- Section 3: Start Time Control -->
            <div class="header-section">
                <div class="start-time-container">
                    <label for="start-time-input">Start Time:</label>
                    <input type="time" id="start-time-input" step="1">
                    <button id="now-button">Now</button>
                </div>
            </div>
            
            <!-- Section 4: Current Time -->
            <div class="header-section current-time-section">
                <div class="current-time-container">
                    <div id="current-time">00:00:00</div>
                </div>
            </div>
        </div>
        <div class="current-info-container">
            <div class="current-section-display">
                <div class="section-info-display">
                    <div id="current-section-name"></div>
                    <div id="current-section-duration"></div>
                </div>
                <div id="time-remaining"></div>
                <div class="time-adjustment-buttons">
                    <button id="time-minus">-</button>
                    <button id="time-plus">+</button>
                </div>
            </div>
        </div>
        <div class="timeline-container">
            <div id="timeline"></div>
        </div>
        <div id="presentation-timeline"></div>
        <div id="debug-time" style="display: none;">Debug time: <span id="debug-time-value">00:00:00</span></div>
    </div>
    <script src="script.js"></script>
</body>
</html>
